<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>å…„å¼Ÿç»„ä»¶é€šä¿¡</title>
</head>
<body>
    <div id="app"></div>
    <script src="./vue.min.js"></script>
    <script>
        /* 
            bus å®ç°å¹³çº§ç»„ä»¶ä¼ å€¼ï¼š
                    1. åˆ›å»ºä¸€ä¸ªå…¨å±€çš„ Vueå¯¹è±¡ä½œä¸ºäº‹ä»¶æ€»çº¿ï¼Œ let bus = new Vue()
                    2. åœ¨å‘é€ç»„ä»¶é‡Œç»™buttonè®¾ç½®ä¸€ä¸ªç‚¹å‡»äº‹ä»¶ï¼Œå“åº”ç‚¹å‡»äº‹ä»¶çš„å¤„ç†å‡½æ•°ä¸­ï¼Œç”¨$emit()è§¦å‘ä¸€ä¸ªè‡ªå®šä¹‰äº‹ä»¶ï¼Œå¹¶ä¼ é€’ä¸€ä¸ªå‚æ•°
                    3. åœ¨æ¥æ”¶ç»„ä»¶é‡Œï¼Œåœ¨å‘¨æœŸé’©å­å‡½æ•° mouted()æˆ–created()é‡Œç”¨$on()ç›‘å¬ä¸Šè¿°çš„è‡ªå®šä¹‰äº‹ä»¶ï¼Œå¹¶åœ¨å›è°ƒå‡½æ•°ä¸­å¤„ç†æ¥æ”¶åˆ°çš„å‚æ•°
        */
        let bus = new Vue();        // step1

        let com1 = {
            template:`
                <div>
                    <input v-model='msg'/>  
                    <button @click = 'sendMsg'>å‘å¹³çº§ç»„ä»¶ä¼ å€¼</button>  
                </div>
            `,
            data(){
                return {
                    msg : 'com1'
                }
            },
            methods:{
                sendMsg(){
                    bus.$emit('receiveMsg',this.msg)    // step2
                }
            }
        };
        let com2 = {
            template:`
                <div>
                    <h1>{{msg}}</h1>    
                </div>
            `,
            data(){
                return {
                    msg : 'com2'
                }
            },
            created(){
                let _this = this
                bus.$on('receiveMsg',function(data){        // step3
                    _this.msg = data
                    console.log('ç»„ä»¶2é‡Œbus.$onç›‘å¬åˆ°äº†', data)
                    console.log('ç»„ä»¶2é‡Œthis.msg', _this.msg)
                })         
                 /* ğŸ‘† ä¸€å®šè¦ç‰¹åˆ«æ³¨æ„bus.$on ä¸­å›è°ƒå‡½æ•°é‡Œçš„ this çš„æŒ‡å‘ï¼Œè‹¥æ²¡æœ‰è®¾ _this = this è€Œç›´æ¥ç”¨ this, 
                 this æŒ‡å‘ bus è€Œä¸æ˜¯è¿™ä¸ªç»„ä»¶ï¼Œæ­¤å¤„ä¹Ÿå¯ä»¥ç›´æ¥ç”¨ç®­å¤´å‡½æ•°ï¼Œè®©thisæŒ‡å‘çˆ¶çº§ä½œç”¨åŸŸ*/
            }
        }
        new Vue({
            el:'#app',
            template:`
                <div>
                    <com1></com1>
                    <hr/>
                    <com2></com2>    
                </div>
            `,
            components:{
                com1,
                com2
            },
            created(){
                bus.$on('receiveMsg',function(data){
                    this.msg = data
                    console.log('appé‡Œbus.$onç›‘å¬åˆ°äº†', data)
                    console.log('appé‡Œthis.msg', this.msg)
                })
            }
        })
    </script>
</body>
</html>