## 从输入 url 到发起http请求的过程中发生了什么
***
流程：  
1. 解析域名  
2. 发起 TCP 的 3 次握手
3. 建立 TCP 连接后发起 HTTP 请求
4. 服务器响应 HTTP 请求，浏览器得到 HTML 代码
5. 浏览器解析 HTML 代码，并请求HTML代码中的资源(js,css,img...)
6. 断开TCP链接
7. 浏览器对页面进行渲染呈现给用户

### 1. DNS 查询IP
&emsp;&emsp;DNS(Domain Name System),即域名系统，是 Internet 的一项服务，他是域名和 IP地址相互映射的一个分布式数据库  
&emsp;&emsp;输入域名，需要进行 DNS 查询，将域名解析成 IP，进行DNS查询的主机或者软件叫做DNS解析器。域名解析就是利用解析器得到对应IP的过程。下面以 www.google.com 为例  
&emsp;&emsp;主要过程：
>1. 在浏览器自身的DNS缓存中查找域名对应的IP，如果有且没有过期，解析到此结束 
>2. 浏览器缓存中未找到，则在操作系统的DNS缓存中查找。如果有且没有过期，解析到此结束 
>3. 若操作系统里的DNS缓存也没有找到，则会尝试读取 hosts文件，查找这里有没有域名对应的IP,如果有则解析成功   
  
如果以上都没有找到，则继续往下，向 DNS服务器查询
>4. 浏览器发起一个DNS的系统调用，向本地配置的首选DNS服务器(LDNS，由电信运营商提供)发起域名解析请求，这个请求是递归的请求（即运营商的DNS服务器必须的提供给我们该域名的IP地址）.    
1）运营商的DNS服务器首先查找自身缓存，如果找到对应条目且没有过期，则解析成功。  
2） 如果没有找到，则由运营商的 DNS 替浏览器发起迭代DNS解析请求，首先找到根域DNS服务器的IP地址，访问到根域的地址后，就会发起请求（www.google.com 这个域名的ip是多少？），根域发现这是一个顶级域com域的一个域名，于是回复，这个域存在com域里，我给你com域的IP，你找他问去  
3） 运营商的DNS 找到com域后，会继续请求（www.google.com 这个域名的ip是多少？），com域不知道 www.google.com 对应的IP,把 google.com域 的 IP 告诉运营商的DNS服务器,让它继续问下去  
4） 运营商的DNS服务器找到google.com域后，发起请求（www.google.com 这个域名的ip是多少？），google.com查询自己的 ZONE文件(即区域文件记录)，找到 www.google.com 对应的 IP ,返回给了运营商的DNS  
5） LDNS 把 IP 返回给用户电脑解析器，用户电脑解析器拿到结构后，缓存在操作系统的DNS缓存中，并返回给浏览器，浏览器拿到IP进行下一步动作

DNS 解析耗时，如果域名过长，可用 dns-prefetch 优化

### 2. TCP/IP请求
&emsp;&emsp;HTTP 本质是tcp协议。TCP(Transmission Control Protocol 传输控制协议)是一种面向连接的、可靠的、基于字节流的传输层通信协议。他可以保证发送端和接收端通信主机之间的通信可达，能够防止传输过程中的丢包、乱序等异常，还能有效利用带宽，缓解网络拥堵。  
&emsp;&emsp;TCP 3次 “握手”
>1. 请求建立连接，客户端发送连接报文请求，客户端进入 syn_sent 状态，表示等待服务端的回复
>2. 服务端收到客户端发过来的报文，知道客户端要建立联机。然后向客户端发送一个报文。服务器进入 syn_rcvd 状态，表示服务器已经接收到客户端的请求，等待客户端确认
>3. 客户端收到服务端返回的报文，检查返回的内容是否正确，若报文正确，客户端再次发送确认包。一旦客户端确认，这个 TCP链接就进入 Established 状态，就可以发起http请求了。