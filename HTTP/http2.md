http2 notes

## 特点 
1. 标头字段压缩
2. 同一链接上进行多个并发交换
3. 为请求设置优先级
4. 二进制分帧对消息进行更高效处理

## 二进制分帧层
>“层”指的是新的编码机制，位于套接字接口与应用可见的高级 HTTP API 之间

## 数据流、消息、帧
>**数据流**： 已建立链接内部的双向字节流，可承载一条或多条消息  
**消息**： 与逻辑请求或响应消息对应的完整的一系列帧  
**帧**： HTTP/2 通信的最小单位，都包含帧头，都标识当前帧所属的数据流  

+ 所有通信都在一个TCP连接上完成，此连接可以可以承载任意数量的双向数据流
+ 每个数据流都有一个唯一标识符和可选的优先级信息，用于承载双向消息
+ 每条消息都是一条逻辑 HTTP 消息（例如请求或响应），包含一个或多个帧
+ 帧是最小的通信单位，承载着特定类型的数据，例如 HTTP 标头、消息负载等等。 *来自不同数据流的帧可以交错发送，然后再根据每个帧头的数据流标识符重新组装*

## 请求和响应复用
将 HTTP 消息分解为独立的帧，交错发送，然后在另一端重新组装是 HTTP 2 最重要的一项增强。  
性能提升：  
+ 并行交错地发送多个请求，请求之间互不影响
+ 并行交错地发送多个响应，响应之间互不影响
+ 使用一个连接并行发送多个请求和响应
+ 消除不必要的延迟和提高现有网络容量的利用率，从而减少页面加载时间
+ 不必再为绕过 HTTP/1.x 限制而做很多工作

## 数据流优先级
客户端和服务器交错发送和传输这些帧的顺序是关键的性能决定因素  
HTTP/2 标准允许每个数据流都有一个关联的权重和依赖关系：
+ 可以向每个数据流分配一个介于1-256之间的整数
+ 每个数据流与其他数据流之间可以存在显式依赖关系

> 数据流依赖关系和权重的组合让客户端可以构建和传递“优先级树”，表明它倾向于如何接收响应。 反过来，服务器可以使用此信息通过控制 CPU、内存和其他资源的分配设定数据流处理的优先级，在资源数据可用之后，带宽分配可以确保将高优先级响应以最优方式传输至客户端。  
HTTP/2 内的数据流依赖关系通过将另一个数据流的唯一标识符作为父项引用进行声明；如果忽略标识符，相应数据流将依赖于“根数据流”。 声明数据流依赖关系指出，应尽可能先向父数据流分配资源，然后再向其依赖项分配资源。

